---
title: "Predicting the age of abalone"
author: "Abirham"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: show
    number_sections: true
    toc: yes
    toc_depth: 3
    toc_float: true
---


## Methods
```{r, eval=FALSE, message=FALSE, warning=FALSE}
#Run these commands to install all the required packages for this report
install.packages("readr")
install.packages("dplyr")
install.packages("car")
install.packages("lmtest")
install.packages("ggplot2")
install.packages("GGally")
install.packages("gridExtra")
install.packages("MASS")
install.packages("leaps")
install.packages("glmnet")
install.packages("caret")
install.packages("gbm")

```

```{r Installing/Loading Packages, message=FALSE, warning=FALSE}
#loading all necessary packages 
library(readr)
library(dplyr)
library(car)
library(lmtest)
library(ggplot2)
library(GGally)
library(gridExtra)
library(MASS)
library(leaps)
library(glmnet)
library(caret)
library(gbm)
```



```{r}
# Corrected file path with forward slashes
abalone=read.csv("D:/Githubfordatamining/FA24-DATS6101-11/HW/Abalone_data.csv")
head(abalone)


```

```{r}
abalone$Sex <- as.factor(abalone$Sex)
str(abalone, give.attr = FALSE)
```

```{r}
library(knitr)
kable(abalone[1:10,], digits = 4,format = 'markdown')
```

```{r}
library(skimr)
skim(abalone)


```

```{r}

categoric_features <- colnames(abalone)[sapply(abalone, function(col) is.factor(col) || is.character(col))]

categoric_features

```

```{r}
numeric_features <- abalone %>% 
  select_if(is.numeric) %>% 
  colnames()
numeric_features
```

```{r}
library(ggplot2)
library(gridExtra) 
library(grid)     

numeric_features <- colnames(abalone)[sapply(abalone, is.numeric)]
# Create a list to store individual ggplot objects
plots <- list()

# Generate histograms for each numeric feature
for (i in seq_along(numeric_features)) {
  num_feat <- numeric_features[i]
  p <- ggplot(abalone, aes_string(x = num_feat)) +
    geom_histogram(aes(y = ..density..), color = "gray", 
                   fill = scales::hue_pal()(length(numeric_features))[i], bins = 30) +
    geom_density(color = "black", size = 1) +
    labs(title = paste("Distribution of", num_feat),
         x = num_feat,
         y = "Density") +
    theme_minimal(base_size = 12) +
    theme(plot.title = element_text(hjust = 0.5, face = "bold"))
  
  # Print each plot to check
  print(p)
  
  # Store the plot in the list
  plots[[i]] <- p
}

```
```{r}


# Divide variables into groups
group_1 <- c("Length", "Diameter", "Height","Shell.weight")
group_2 <- c("Whole.weight", "Shucked.weight","Viscera.weight" ,"Rings")

# First pairs plot
plot1 <- ggpairs(abalone[, c(group_1, "Sex")], 
                 aes(colour = Sex, alpha = 0.8),
                 title = "Pairs Plot - Group 1") +
  theme_grey(base_size = 8)

# Second pairs plot
plot2 <- ggpairs(abalone[, c(group_2, "Sex")], 
                 aes(colour = Sex, alpha = 0.8),
                 title = "Pairs Plot - Group 2") +
  theme_grey(base_size = 8)

# Display both plots
print(plot1)
print(plot2)


```


```{r}

library(ggplot2)
for (num_feat in numeric_features) {
  p <- ggplot(data = abalone, aes_string(x = "Sex", y = num_feat)) +
    geom_boxplot(fill = "skyblue", outlier.color = "red", outlier.size = 1.5) + # Custom fill color
    labs(
      title = paste("Box Plot of", num_feat),
      x = "Sex",
      y = num_feat
    ) +
    theme_minimal(base_size = 14) +
    theme(
      plot.title = element_text(hjust = 0.5, face = "bold", size = 16),
      axis.text = element_text(size = 12),
      axis.title = element_text(size = 14)
    )
  
  print(p)
}


```

```{r}

library(ggplot2)
library(patchwork)
library(gridExtra)
library(ggplot2)

numeric_features <- colnames(abalone)[sapply(abalone, is.numeric)]

# Loop through each numeric feature and create Q-Q plots separately
for (num_feat in numeric_features) {
  # Generate the Q-Q plot
  p <- ggplot(data = abalone, aes(sample = .data[[num_feat]])) +
    stat_qq(color = "skyblue", size = 2) +  # Q-Q plot points
    stat_qq_line(color = "red", linetype = "dashed", size = 1) +  # Reference line
    labs(
      title = paste("Q-Q Plot of", num_feat),
      x = "Theoretical Quantiles",
      y = "Sample Quantiles"
    ) +
    theme_minimal(base_size = 14) +
    theme(
      plot.title = element_text(hjust = 0.5, face = "bold", size = 16),
      axis.text = element_text(size = 10),
      axis.title = element_text(size = 12)
    )
  
  print(p)
}

```

```{r}
library(ggplot2)
library(dplyr)

categoric_feature <- colnames(abalone)[sapply(abalone, is.factor)][1]


category_counts <- abalone %>%
  count(.data[[categoric_feature]]) %>%
  mutate(Percentage = n / sum(n) * 100)  

ggplot(category_counts, aes(x = "", y = Percentage, fill = .data[[categoric_feature]])) +
  geom_bar(stat = "identity", width = 1, color = "black") + 
  coord_polar(theta = "y", start = 0) +  
  scale_fill_brewer(palette = "Set3") +  
  labs(
    title = categoric_feature,
    fill = categoric_feature
  ) +
  theme_void(base_size = 14) + 
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 16),
    legend.title = element_text(size = 14, face = "bold"),
    legend.text = element_text(size = 12)
  ) +
  geom_text(
    aes(label = sprintf("%.1f%%", Percentage)),
    position = position_stack(vjust = 0.5),
    size = 4,
    color = "black"
  )


```

```{r}
library(reshape2)

numeric_features <- colnames(abalone)[sapply(abalone, is.numeric)]
corr_matrix <- cor(abalone[, numeric_features], use = "complete.obs", method = "pearson")
mask <- upper.tri(corr_matrix)


corr_melt <- melt(corr_matrix)
corr_melt <- corr_melt[!mask, ]

ggplot(corr_melt, aes(Var1, Var2, fill = value)) +
  geom_tile(color = "black", linewidth = 1) +  
  scale_fill_gradient2(low = "red", high = "skyblue", mid = "white", midpoint = 0) +  
  geom_text(aes(label = sprintf("%.2f", value)), size = 3.5, fontface = "bold", color = "black") + 
  labs(title = "Correlation Matrix", fill = "Correlation") +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0, face = "bold", size = 16, margin = margin(b = 10)),
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),
    axis.text.y = element_text(size = 10),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10)
  )

```